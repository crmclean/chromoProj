cpdName <- keggFind("cpd", checkCpds[i])
cpdInfo <- list()
pathways <- keggLink("pathway", checkCpds[i])
cpdInfo[[i]] <- pathways
names(cpdInfo)[i] <- cpdName
names(cpdInfo)[i]
cpdInfo
pathwayNames <- keggList(pathways)
pathwayNames
cpdInfo <- list()
for(i in 1:length(checkCpds)) {
cpdName <- keggFind("cpd", checkCpds[i])
pathways <- keggLink("pathway", checkCpds[i])
pathwayNames <- keggList(pathways)
cpdInfo[[i]] <- pathwayNames
names(cpdInfo)[i] <- cpdName
}
library(foreach)
cpdInfo <- list()
cpdInfo <- foreach(i = 1:length(checkCpds)) %dopar% {
cpdName <- keggFind("cpd", checkCpds[i])
pathways <- keggLink("pathway", checkCpds[i])
pathwayNames <- keggList(pathways)
cpdInfo[[i]] <- pathwayNames
names(cpdInfo)[i] <- cpdName
cpdInfo
}
library(doMC)
registerDoMC(cores=4)
cpdInfo <- list()
cpdInfo <- foreach(i = 1:length(checkCpds)) %dopar% {
cpdName <- keggFind("cpd", checkCpds[i])
pathways <- keggLink("pathway", checkCpds[i])
pathwayNames <- keggList(pathways)
cpdInfo[[i]] <- pathwayNames
names(cpdInfo)[i] <- cpdName
cpdInfo
}
cpdName
pathways
pathwayNames
cpdInfo
cpdName
paste(names(cpdName), cpdName, sep = ":")
paste(names(cpdName), cpdName, sep = ":=")
cpdInfo <- list()
for(i in 1:length(checkCpds)) {
cpdName <- keggFind("cpd", checkCpds[i])
pathways <- keggLink("pathway", checkCpds[i])
pathwayNames <- keggList(pathways)
cpdInfo[[i]] <- pathwayNames
names(cpdInfo)[i] <- paste(names(cpdName), cpdName, sep = ":=")
}
i
pathwayNames
cpdName
cpdInfo
sleep(1)
Sys.sleep(1)
msconvert <-
"poop"
paste(msconvert, "--mzML --filter \"peakPicking true 1-3\" --filter \"msLevel 1-3\" -o mzML_noThreshold")
i
cpdName <- keggFind("cpd", checkCpds[i])
pathways <- keggLink("pathway", checkCpds[i])
pathwayNames <- keggList(pathways)
keggList(pathways)
tryCatch(keggList(pathways), error = "No Match")
tryCatch(keggList(pathways), error = function(e) "No Match")
cpdName <- tryCatch(keggFind("cpd", checkCpds[i]), error = function(e) "No cpd match")
pathways <- tryCatch(keggLink("pathway", checkCpds[i]), error = function(e) "No pathway match")
pathwayNames <- tryCatch(keggList(pathways), error = function(e) "No pathway name match")
cpdInfo[[i]] <- pathwayNames
pathways
cpdInfo <- list()
for(i in 1:length(checkCpds)) {
cpdName <- tryCatch(keggFind("cpd", checkCpds[i]), error = function(e) "No cpd match")
pathways <- tryCatch(keggLink("pathway", checkCpds[i]), error = function(e) "No pathway match")
if(length(pathways) == 0) {
pathwayNames <- "No Pathway match"
} else {
pathwayNames <- tryCatch(keggList(pathways), error = function(e) "No pathway name match")
}
cpdInfo[[i]] <- pathwayNames
names(cpdInfo)[i] <- paste(names(cpdName), cpdName, sep = ":=")
Sys.sleep(1)
}
cpdInfo
devtools::install_github('wilsontom/MRMConverteR')
library(MRMConverteR)
library(here)
convertFiles <- list.files(here("data/2018-04-18/rawData/srmData/"), pattern = ".mzML")
convertFiles
path2data <- here("data/2018-04-18/rawData/srmData/")
convertFiles <- list.files(path2data, pattern = ".mzML")
convertFiles
file.path(path2data,convertFiles)
path2data <- here("data/2018-04-18/rawData/srmData/")
convertFiles <- list.files(path2data, pattern = ".mzML")
for(file in file.path(path2data,convertFiles)) {
convert(file, path2data, return = FALSE)
}
?convert
library(mzR)
openMSfile(file.path(path2data,convertFiles)[1])
MRMfile <- openMSfile(file.path(path2data,convertFiles)[1])
nChrom(MRMfile)
MRMfile <- openMSfile(file.path(path2data,convertFiles)[1])
nChrom(MRMfile)
for(file in file.path(path2data,convertFiles)) {
convert(file, path2data, return = FALSE)
}
mzR::chromatograms(MRMfile)
chrom_raw <- mzR::chromatograms(MRMfile)
chrom_raw
filter_id <- purrr::map(chrom_raw, ~ {
names(.)[[2]]
}) %>% unlist(.)
filter_id
filter_polarity <- purrr::map_dbl(filter_id, extract_polarity)
install.packages("purrr")
install.packages("purrr")
filter_polarity <- purrr::map_dbl(filter_id, extract_polarity)
library(MRMConverteR)
library(mzR)
filter_polarity <- purrr::map_dbl(filter_id, extract_polarity)
?map_dbl
??extract_polarity
source('~/MIT/Research/chromoProj/checkKeggCpds.R', echo=TRUE)
cpdInfo[[1]]
cpdInfo[[i]]
i
cpdTable <- list()
for(i in 1:length(cpdInfo)) {
cpdName <- names(cpdInfo)[i]
paths <- cpdInfo[[i]]
cpdTable[[i]] <- data.frame(cpdName, paths)
}
plyr::ldply(cpdTable, data.frame)
length(cpdInfo)
i
library(doMC)
registerDoMC(cores=4)
registerDoMC(cores=3)
cpdInfo <- list()
foreach::foreach(i = 1:length(checkCpds))  %dopar% {
cpdName <- tryCatch(keggFind("cpd", checkCpds[i]), error = function(e) "No cpd match")
pathways <- tryCatch(keggLink("pathway", checkCpds[i]), error = function(e) "No pathway match")
if(length(pathways) == 0) {
pathwayNames <- "No Pathway match"
} else {
pathwayNames <- tryCatch(keggList(pathways), error = function(e) "No pathway name match")
}
cpdInfo[[i]] <- pathwayNames
names(cpdInfo)[i] <- paste(names(cpdName), cpdName, sep = ":=")
Sys.sleep(1)
}
source('~/MIT/Research/xcmsAutotuner/functions/checkEICPeaks.R', echo=TRUE)
cpdInfo <- foreach::foreach(i = 1:3)  %dopar% {
cpdName <- tryCatch(keggFind("cpd", checkCpds[i]), error = function(e) "No cpd match")
pathways <- tryCatch(keggLink("pathway", checkCpds[i]), error = function(e) "No pathway match")
if(length(pathways) == 0) {
pathwayNames <- "No Pathway match"
} else {
pathwayNames <- tryCatch(keggList(pathways), error = function(e) "No pathway name match")
}
cpdInfo[[i]] <- pathwayNames
names(cpdInfo)[i] <- paste(names(cpdName), cpdName, sep = ":=")
Sys.sleep(1)
cpdInfo[[i]]
}
cpdInfo <- list()
cpdInfo <- foreach::foreach(i = 1:3)  %dopar% {
cpdName <- tryCatch(keggFind("cpd", checkCpds[i]), error = function(e) "No cpd match")
pathways <- tryCatch(keggLink("pathway", checkCpds[i]), error = function(e) "No pathway match")
if(length(pathways) == 0) {
pathwayNames <- "No Pathway match"
} else {
pathwayNames <- tryCatch(keggList(pathways), error = function(e) "No pathway name match")
}
cpdInfo[[i]] <- pathwayNames
names(cpdInfo)[i] <- paste(names(cpdName), cpdName, sep = ":=")
Sys.sleep(1)
cpdInfo[[i]]
}
cpdInfo
cpdInfo <- list()
cpdInfo <- foreach::foreach(i = 1:length(checkCpds))  %dopar% {
cpdName <- tryCatch(keggFind("cpd", checkCpds[i]), error = function(e) "No cpd match")
pathways <- tryCatch(keggLink("pathway", checkCpds[i]), error = function(e) "No pathway match")
if(length(pathways) == 0) {
pathwayNames <- "No Pathway match"
} else {
pathwayNames <- tryCatch(keggList(pathways), error = function(e) "No pathway name match")
}
pathwayNames
}
cpdInfo
moduleInfo <- list()
cpdName <- tryCatch(keggFind("cpd", checkCpds[i]), error = function(e) "No cpd match")
pathways <- tryCatch(keggLink("module", checkCpds[i]), error = function(e) "No pathway match")
pathways
pathways <- tryCatch(keggLink("modules", checkCpds[i]), error = function(e) "No pathway match")
pathways
i <- 1
cpdName <- tryCatch(keggFind("cpd", checkCpds[i]), error = function(e) "No cpd match")
pathways <- tryCatch(keggLink("modules", checkCpds[i]), error = function(e) "No pathway match")
pathways
cpdName
checkCpds[i]
i <- 100
cpdName <- tryCatch(keggFind("cpd", checkCpds[i]), error = function(e) "No cpd match")
pathways <- tryCatch(keggLink("modules", checkCpds[i]), error = function(e) "No pathway match")
pathways
pathways <- tryCatch(keggLink("module", checkCpds[i]), error = function(e) "No pathway match")
pathways
i <-33
cpdName <- tryCatch(keggFind("cpd", checkCpds[i]), error = function(e) "No cpd match")
pathways <- tryCatch(keggLink("module", checkCpds[i]), error = function(e) "No pathway match")
pathways
?keggLink
listDatabases()
moduleInfo <- list()
moduleInfo <- foreach::foreach(i = 1:length(checkCpds))  %dopar% {
cpdName <- tryCatch(keggFind("cpd", checkCpds[i]), error = function(e) "No cpd match")
module <- tryCatch(keggLink("module", checkCpds[i]), error = function(e) "No module match")
if(length(pathways) == 0) {
pathwayNames <- "No Pathway match"
} else {
modNames <- tryCatch(keggList(module), error = function(e) "No module name match")
}
modNames
}
moduleInfo
moduleInfo <- list()
moduleInfo <- foreach::foreach(i = 1:length(checkCpds))  %dopar% {
cpdName <- tryCatch(keggFind("cpd", checkCpds[i]), error = function(e) "No cpd match")
module <- tryCatch(keggLink("module", checkCpds[i]), error = function(e) "No module match")
if(length(pathways) == 0) {
modNames <- "No module match"
} else {
modNames <- tryCatch(keggList(module), error = function(e) "No module name match")
}
modNames
}
moduleInfo
cpdInfo
path2Data
for(i in 1:length(cpdInfo)) {
cpdName <- names(cpdInfo)[i]
paths <- cpdInfo[[i]]
cpdTable[[i]] <- data.frame(cpdName, paths)
}
cpdTable <- list()
for(i in 1:length(cpdInfo)) {
cpdName <- names(cpdInfo)[i]
paths <- cpdInfo[[i]]
cpdTable[[i]] <- data.frame(cpdName, paths)
}
cpdTable <- list()
for(i in 1:length(cpdInfo)) {
cpdName <- names(cpdInfo)[i]
paths <- cpdInfo[[i]]
cpdTable[[i]] <- data.frame(cpdName, paths)
}
cpdName
cpdInfo
checkCpds[i]
cpdTable <- list()
for(i in 1:length(cpdInfo)) {
cpdName <- checkCpds[i]
paths <- cpdInfo[[i]]
cpdTable[[i]] <- data.frame(cpdName, paths)
}
plyr::ldply(cpdTable, data.frame)
pathwayTable <- plyr::ldply(cpdTable, data.frame)
pathwayTable
table(pathwayTable)
table(apply(pathwayTable, 1, paste, sep = "_"))
apply(pathwayTable, 1, paste, sep = "_")
pathwayTable
paste(pathwayTable$cpdName, pathwayTable$paths, sep = "_")
table(paste(pathwayTable$cpdName, pathwayTable$paths, sep = "_"))
cpdPathCounts <- table(paste(pathwayTable$cpdName, pathwayTable$paths, sep = "_"))
cpdPathCounts > 1
cpdPathCounts[cpdPathCounts > 1]
pathwayTable
checkCpds
path2Data
table(path2Data$Matched.Compound )
as.numeric(table(path2Data$Matched.Compound))
pathwayTable
colnames(pathwayTable)
path2Data
path2Data %>% colnames()
colnames(pathwayTable)[1] <- "Matched.Compound"
path2Data
dplyr::left_join(pathwayTable, path2Data, "Matched.Compound")
dplyr::left_join(pathwayTable, path2Data, "Matched.Compound") %>% View()
cpdTable
dplyr::full_join(pathwayTable, path2Data, "Matched.Compound") %>% View()
cpdPathTable <- dplyr::full_join(pathwayTable, path2Data, "Matched.Compound") %>% View()
cpdPathTable <- dplyr::full_join(pathwayTable, path2Data, "Matched.Compound")
cpdPathTable$paths %>% unique()
test <- cpdPathTable$paths %>% unique()
grep(test, pattern = "meth")
test[grep(test, pattern = "meth")]
test[grep(test, pattern = "Methane")]
grep(test, pattern = "Methane")
cpdPathTable %>% colnames()
test <- cpdPathTable %>% filter(paths = "Methane metabolism")
test <- cpdPathTable %>% filter(paths == "Methane metabolism")
test
(445.171 - 444.1583)/445.171
(445.171 - 444.1583)/445.171 * 10^6
(445.171 - 444.1583)/445.171
(445.171 - 444.1583)/445.171 * 10^6
(445.171 - 444.1583 + 1.0078)/445.171 * 10^6
(445.171 - 444.1583 - 1.0078)/445.171 * 10^6
cpdPathTable$Matched.Compound == "C00199"
any(cpdPathTable$Matched.Compound == "C00199")
test
cpdPathTable %>% mutate(ppm = Query.Mass/Mass.Diff * 10^6)
cpdPathTable %>% mutate(ppm = Query.Mass/Mass.Diff * 10^6)
cpdPathTable %>% mutate(ppm = Mass.Diff/Query.Mass * 10^6)
cpdPathTable %>% mutate(ppm = round(Mass.Diff/Query.Mass * 10^6))
cpdPathTable %>% mutate(ppm = round(Mass.Diff/Query.Mass * 10^6)) %>% mutate(Mass.Diff == NULL)
cpdPathTable %>% mutate(ppm = round(Mass.Diff/Query.Mass * 10^6)) %>% select(-one_of(Mass.Diff))
cpdPathTable <- cpdPathTable %>% mutate(ppm = round(Mass.Diff/Query.Mass * 10^6))
cpdPathTable
unique(cpdPathTable)
cpdPathTable
unique(cpdPathTable)
cpdPathTable <- unique(cpdPathTable)
cpdPathTable$ppm %>% hist()
cpdPathTable
cpdPathTable %>% head()
cpdPathTable <- unique(cpdPathTable[,-5])
cpdPathTable
cpdPathTable %>% head()
cpdPathTable %>% head(n = 2)
cpdPathTable %>% head(n = 20)
cpdPathTable
cpdPathTable$paths
grep(cpdPathTable$paths, "Carbon Fixation", ignore.case = T)
cpdPathTable$paths
grep("Carbon Fixation",cpdPathTable$paths, ignore.case = T)
cpdPathTable$paths[grep("Carbon Fixation",cpdPathTable$paths, ignore.case = T)]
cpdPathTable$paths[grep("Carbon fixation pathways in prokaryotes",
cpdPathTable$paths, ignore.case = T)]
cpdPathTable[grep("Carbon fixation pathways in prokaryotes",
cpdPathTable$paths, ignore.case = T),]
cpdPathTable[grep("Methane", cpdPathTable$paths, ignore.case = T),]
cpdPathTable[grep("Oxocarboxylic acid", cpdPathTable$paths, ignore.case = T),]
library(dplyr)
library(dplyr)
library(here)
source("~/MIT/Research/MMETSP_Project/scr/2017-12-16/QA/mtabQA.R")
# Loading metadata and real data ------------------------------------------
runfile <- read.csv(here("data/CROMO_11_metadata.csv"), stringsAsFactors = F)
# path to files
## change this path every time
data <- read.csv(here("data/2018-04-18/metaboAnalyst_Input/chromoPeaks.csv"))
qaOutput <- mtabQA(data = dataList, metadata = runfile)
dataList2 <- qaOutput$data
source("~/MIT/Research/MMETSP_Project/scr/2017-12-16/QA/mtabQA.R")
# Loading metadata and real data ------------------------------------------
runfile <- read.csv(here("data/CROMO_11_metadata.csv"), stringsAsFactors = F)
# path to files
## change this path every time
data <- read.csv(here("data/2018-04-18/metaboAnalyst_Input/chromoPeaks.csv"))
data
data %>% head()
runfile$Type
runfile$Well
runfile$Sample.Name[runfile$Well %in% "blank"]
runfile$Sample.Name[runfile$Well %in% "Blank"]
data
data %>% colnames()
colnames(data) %in% runfile$Sample.Name[runfile$Well %in% "Blank"]
blankCols <- which(colnames(data) %in% runfile$Sample.Name[runfile$Well %in% "Blank"] )
blankCols <- colnames(data)[colnames(data) %in% runfile$Sample.Name[runfile$Well %in% "Blank"]]
blankCols
colId <- sub("_00[0-9]", "", blankCols[1])
colId
curCol
blankCols
colId
curCol
blankCols
colId
blankCols <- colnames(data)[colnames(data) %in% runfile$Sample.Name[runfile$Well %in% "Blank"]]
colId <- sub("_00[0-9]", "", blankCols[1])
for(curCol in blankCols) {
blankCol <- data[,colnames(data) %in% curCol]
blankType <- runfile$Type[runfile$Well == curCol]
removeRows <- which(!is.na(blankCol))
correctData <- colnames(data) %in% runfile$Sample.Name[runfile$Type %in% blankType]
data[removeRows,correctData] <- NA
}
data
grep(colId, colnames(data))
data[,grep(colId, colnames(data))]
data[,grep(colId, colnames(data))] %>% apply(1, function(row) {sum(is.na(row)) == length(row)})
data[,grep(colId, colnames(data))] %>% apply(1, function(row) {sum(is.na(row)) == length(row)}) %>% sum()
data[,grep(colId, colnames(data))]
data[1,grep(colId, colnames(data))]
rowtest <- data[1,grep(colId, colnames(data))]
is.na(rowtest)
data[,grep(colId, colnames(data))] %>% apply(1, function(row) {print(class(row));
sum(is.na(row)) == length(row)})
data
# Loading metadata and real data ------------------------------------------
runfile <- read.csv(here("data/CROMO_11_metadata.csv"), stringsAsFactors = F)
data <- read.csv(here("data/2018-04-18/metaboAnalyst_Input/chromoPeaks.csv"))
data %>% View()
data %>% View()
data[82,]
removeRows
correctData
colnames(data)
runfile$Sample.Name[runfile$Type %in% blankType]
runfile$Type
blankType
curCol
blankCol <- data[,colnames(data) %in% curCol]
blankCol
blankType <- runfile$Type[runfile$Well == curCol]
blankType
runfile$Well == curCol
curCol
runfile$Sample.Name == curCol
blankType <- runfile$Type[runfile$Sample.Name == curCol]
blankType
removeRows <- which(!is.na(blankCol))
removeRows
## determining which columns are same type as blank to correct
blankType <- runfile$Type[runfile$Sample.Name == curCol]
correctData <- colnames(data) %in% runfile$Sample.Name[runfile$Type %in% blankType]
correctData
data[removeRows,correctData]
blankCols <- colnames(data)[colnames(data) %in% runfile$Sample.Name[runfile$Well %in% "Blank"]]
colId <- sub("_00[0-9]", "", blankCols[1])
for(curCol in blankCols) {
## determining type of blank
blankCol <- data[,colnames(data) %in% curCol]
removeRows <- which(!is.na(blankCol))
## determining which columns are same type as blank to correct
blankType <- runfile$Type[runfile$Sample.Name == curCol]
correctData <- colnames(data) %in% runfile$Sample.Name[runfile$Type %in% blankType]
## correcting the data
data[removeRows,correctData] <- NA
}
data
data[,grep(colId, colnames(data))] %>% apply(1, function(row) {sum(is.na(row)) == length(row)})
data[,grep(colId, colnames(data))] %>% apply(1, function(row) {sum(is.na(row)) == length(row)}) %>% sum()
removeRows <- data[,grep(colId, colnames(data))] %>%
apply(1, function(row) {sum(is.na(row)) == length(row)})
removeRows
removeRows %>% sum()
message("Total rows removed through blank correction:" sum(removeRows))
message("Total rows removed through blank correction:", sum(removeRows))
message("Total rows removed through blank correction: ", sum(removeRows))
TripleVennDiagram
??TripleVennDiagram
library(limma)
colId
grep(colId, colnames(data))
blankCol
blankCols
blankMatches <- colnames(data) %in% runfile$Sample.Name[runfile$Well %in% "Blank"]
blankMatches
grep(colId, colnames(data))
which(blankMatches)
grep(colId, colnames(data))[-which(blankMatches)]
# QA on data --------------------------------------------------------------
dataCols <- grep(colId, colnames(data))
dataCols
blankMatches
blankCols
dataCols
dataCols %in% which(blankMatches)
!dataCols %in% which(blankMatches)
dataCols[!dataCols %in% which(blankMatches)]
featureCols <- data[,dataCols[!dataCols %in% which(blankMatches)]]
featureCols
dataObservations <- data[,dataCols[!dataCols %in% which(blankMatches)]]
dataObservations
apply(dataObservations, 2, function(col) {
col[is.na(col)] <- 0
return(col)
})
dataObservations <- apply(dataObservations, 2, function(col) {
col[is.na(col)] <- 0
return(col)
})
dataObservations
# venn diagram ------------------------------------------------------------
obsFeatureColunts %>% apply(2, function(col > 0))
# venn diagram ------------------------------------------------------------
obsFeatureColunts %>% apply(2, function(col) {col > 0})
# venn diagram ------------------------------------------------------------
dataObservations %>% apply(2, function(col) {col > 0})
# venn diagram ------------------------------------------------------------
featureCounts <- dataObservations %>% apply(2, function(col) {col > 0})
vennCounts(featureCounts)
dataObservations %>% nrow()
vennDiagram(vennCounts(featureCounts))
vennCountTable <- vennCounts(featureCounts)
runfile
#colnames(vennCountTable) <- c()
vennDiagram(vennCountTable)
